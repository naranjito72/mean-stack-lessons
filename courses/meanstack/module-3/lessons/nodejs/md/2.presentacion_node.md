class: center, middle, inverse

<img src="https://imgur.com/9b2Dc5n.png" width=50% height=50% alt="logo">


---

name: contenido
class: center, middle, inverse
## [Node.js](#Qu√© es Node.js?)
---
name: default
layout: true
task: &nbsp;

.task[{{task}}]

---
name:contenido

###Contenido

- [Introducci√≥n](#introduccion)
- [Instalaci√≥n](#instalacion)
- [npm](#npm)
- [m√≥dulos](#modulos)
- [callbacks](#callbacks)
- [promesas](#promesas)
- [async-await](#asyncawait)
- [EventEmitter](#eventemitter)
- [Buffers](#buffers)
- [Streams](#streams)
- [FileSystem](#fs)
- [TCP](#tcp)
- [http](#http)
- [socket.io](#socket)

---
name:introduccion
task: [<< √≠ndice de contenidos >>](#contenido)

### Qu√© es Node.js?

Node.js (o abreviadamente _Node_) es un entorno de ejecuci√≥n para JavaScript construido con el motor de JavaScript V8 de Chrome desarrollado por Ryan Dahl, cuando estaba en Joyent. Dahl cre√≥ Node debido a las [limitaciones s√≠ncronas de los _frameworks_ web actuales](https://www.infoq.com/interviews/node-ryan-dahl). Node nos permite correr JavaScript en cualquier sitio, incluidos servidores web y robots

En el pasado, el √∫nico entorno de ejecuci√≥n para JavaScript era el navegador. Chrome, Safari y Internet Explorer ten√≠an su propio entorno, pero no pod√≠amos correr JavaScript fuera de ellos.

Dahl cambi√≥ esto extrayendo `el entorno de ejecuci√≥n V8` de Chrome, y creando una implementaci√≥n para servidores.

### Qu√© no es

- ***No*** es un _framework_ (Hay _frameworks_ construidos sobre Node.js)
  
- ***No*** es un lenguaje de programaci√≥n (el lenguaje es JavaScript)
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Por qu√© Node.js?

- Porque utiliza JavaScript. Lenguaje universal de programaci√≥n. Su curva de aprendizaje es menor para los que est√°n familiarizados con el JavaScript de lado de cliente:

<img class="centered" src="https://imgur.com/BIdlJ0B.png">

- Utiliza un modelo orientado a eventos, sin bloqueos de E/S que hace que sea ligero y eficiente, ideal para aplicaciones que requieren datos en tiempo real y que se ejecutan mediante dispositivos distribuidos
  
- Proporciona una amplia biblioteca de varios m√≥dulos de JavaScript (> 1.000.000) que simplifica el desarrollo de aplicaciones web usando Node.js


???
Because Node uses JavaScript's *event driven* and *asynchronous* model, it excels with certain web applications such as chat applications, and apps that need real time, live updating features.

Another (subjective and debateable) benefit is the language of JavaScript being universal. Theoretically, the learning curve may be lower for those who are already familiar with front-end JavaScript.

Related to that, is the concept of sharing code on your front end and back end because they're written in the same language, although many agree that back end code is very different, even if it is the same language.

In addition, Node has a strong and growing ecosystem. This includes packages created by the community, and continuing open source development on the runtime itself.


Because Node uses [Google's V8](https://developers.google.com/v8/) behind the scenes, Node also benefits from competition between browsers. As Google improves V8 to compete with [Mozilla's SpiderMonkey](https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey), [Microsoft's Chakra](https://github.com/Microsoft/ChakraCore) and others, Node reaps the benefits of those improvements as well.

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Casos de uso

<a href="https://www.netguru.com/blog/top-companies-used-nodejs-production"><img class=centered src=https://imgur.com/TFDerOf.png></a>

<a  href="https://www.youtube.com/watch?v=gtjzjiTI96c&list=PLfXiENmg6yyUpIVY9XVOkbdmBPx6PUm9_" target="_blank"><img class=centered alt="Netflix" src="https://imgur.com/f1i4QE0.png">
</a>

---
name:instalacion
task: [<< √≠ndice de contenidos >>](#contenido)

### Instalando Node.js en Windows

- Conectarse a la p√°gina oficial: https://nodejs.org/es/

  - __LTS¬†versi√≥n__ de Node.js con Long Term Support (LTS). Esta versi√≥n puede¬†no tener¬†disponibles las √∫ltimas tecnolog√≠as que todav√≠a no se consideran estables.

  - __Current__: esta es la versi√≥n m√°s reciente de Node.js e incluye todas las funcionalidades, incluso aquellas m√°s novedosas y que no se consideran estables. Las versiones pares pasan a versiones lts (el actual Node 12 2019 pasar√° en Octubre a ser LTS, con soporte hasta 2022)

- Descargar el __archivo .msi__ y seguir las instrucciones para instalar Node.js. De forma predeterminada, el instalador establece el directorio
  
   `C:\Archivos de programa\nodejs\bin` en las variable de entorno `PATH` de windows. 

- Para comprobar si Node se ha instalado, desde un terminal tecleamos:
      
.inverse[<pre class=codigo>node --version</pre>
]
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Node 12
Pasar√° a LTS en Octubre 2019, incorpora las siguientes mejoras:

1. __Soporte a m√≥dulos ECMAScript__. Se podr√°n utilizar comandos `import` / `export` sin necesidad de utilizar paquetes espec√≠ficos. Soporte para 3 tipos de `import`:

```javascript
// default exports
import module from 'module'
// named exports
import { namedExport } from 'module'
// namespace exports
import * as module from 'module'
```
Si se importa de un package `CommonJS`, s√≥lo se puede utilizar el `import` de la sintaxis de `default export`: `import module from 'cjs-library'`.

Tambi√©n se puede utilizar `import()`din√°mico para cargar ficheros en tiempo de ejecuci√≥n. `import()`devuelve una _promesa_ que puede ser utilizada en m√≥dulos ES y CommonJS, indistintamente.

---

#### 2. V8 Engine

- Node 12  utilizar√° la versi√≥n 7.4 del motor V8 de google que aporta:

  - Parseo m√°s r√°pido de JavaScript
  - Llamadas m√°s r√°pidas a funciones con disparidad de argumentos
  - `await` m√°s r√°pido

---

#### 3. Uso de campos privados en clases

se utilizar√° el simbolo `#` symbol.

    class Greet {
      #name = 'World';
      get name() {
        return this.#name;
      }
      set name(name) {
        this.#name = name;
      }
      sayHello() {
        console.log(`Hello, ${this.#name}`);
      }
    }

Si se intenta acceder a #name desde fuera de la clase se obtendr√° un _syntax error_.

    const greet = new Greet()
    greet.#name = 'NewName';
    // -> SyntaxError
    console.log(greet.#name)
    // -> SyntaxError
---
#### 4. Rendimiento mejorado de arranque

Node 12 presenta una cach√© de c√≥digo binario  para sus propias librer√≠as que mejora el tiempo de arrancada en un 30%.

#### 5. TLS y Seguridad

Soporte a TLS 1.3, que mejora la seguridad y reduce la latencia. Node reduce tambi√©n el tiempo de "saludo" requerido por el protocolo HTTPS (HTTPS handshake). 

#### 6. Tama√±o del Heap de memoria mejorado

Node determina el tama√±o de memoria que se asigna a memoria din√°mica sin reservarla previamente

#### 7. Funcionalidad de volcado Heap (Heap dump)

Node 12 provides the ability to generate a heap dump making it easier to investigate memory issues.

#### 8. Informes de Diagn√≥stico 

Node offers improved ability to diagnose issues (performance, CPU usage, memory, crashes, etc) within applications by providing an experimental diagnostic report feature.
---
#### 9. Mejora del uso de m√≥dulos nativos de N-API

N-API was released to provide a more stable and native Node module system that would prevent libraries from breaking on every release by providing an ABI-stable abstraction over native JavaScript APIs. Node 12 offers improved support for N-API in combination with worker threads.

#### 10. Otras mejoras

- Worker Threads no longer require a flag
- http has updated its default parser to be llhttp
- assert validates required arguments and adjusts loose assertions
- buffer improvements to make it more stable and secure
- async_hooks removes deprecated functionality
- Make global.process, global.Buffer getters to improve process
- A new welcome message for repl


---
task: [<< √≠ndice de contenidos >>](#contenido)

### Usos de Node

Utilizaremos Node para escribir aplicaciones de JavaScript puras y, para crear un servidor web con Express.

### Primer programa en Node
<hr>
Crear un archivo en el directorio de trabajo llamado `test.js`.

En este fichero a√±adiremos el siguiente c√≥digo:
```javascript
    console.log("Hello Node");
```

En el **terminal**:

.inverse[<pre class=codigo>node test</pre>
 Hello Node]

Se puede escribir cualquier c√≥digo JavaScript teniendo en cuenta que __no hay DOM__

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Segundo programa: Instalando un servidor web


1. Creamos un directorio para la aplicacion y entramos:

.inverse[<pre class=codigo-dir><span class=codigo> md prueba-node<span><pre class=codigo-dir><span class=codigo> cd prueba-node<span></pre></pre>
]


2. Creamos un archivo __index.js__ dentro de la carpeta anterior, con el siguiente contenido:
   

    const http = require("http");
    const handler = (request, response) => {
      console.log('Recibimos peticion');
      response.end("<p>Hola Mundo web</p>");
      }
    const server = http.createServer(handler);
    server.listen(8080);
    console.log('Server running at http://127.0.0.1:8080/');
3. Ejecutamos Node desde el terminal:
.inverse[<pre class=codigo>node index</pre>
]
???
Crearemos una aplicaci√≥n web con "Hello, World!" con los siguientes Componentes:
Import de los m√≥dulos requeridos¬†‚àí Mediante la directiva require que carga m√≥dulos Node.js.
Create server¬†‚àí Genera un servidor que escucha peticiones http
Escucha peticiones y devuelve respuestas¬†‚àí El servidor recibe una petici√≥n http de un cliente, navegador o consola y devuelve una respuesta

---
name:npm
task: [<< √≠ndice de contenidos >>](#contenido)

### npm & m√≥dulos


### Intro

**npm** es el gestor de paquetes de Node. Significa que todos los programadores pueden compartir c√≥digo f√°cilmente usando un terminal de l√≠nea de comando

npm tiene el ecosistema de paquetes externos m√°s potente de todas las comunidades de programaci√≥n con m√°s de un 1.000.000 de m√≥dulos para descargar!

**M√≥dulos** son fragmentos de c√≥digo reutilizable empaquetados con todo el c√≥digo del que dependen (dependencias)

---
task: [<< √≠ndice de contenidos >>](#contenido)

#### Utilizando packages npm: Instalaci√≥n de un m√≥dulo

.inverse[<pre class=codigo>npm install --save chalk</pre>
]

`npm install` se dirige a los servidores de npm y selecciona un package llamado "chalk". `--save` a√±ade la dependencia al archivo `package.json`.

Adem√°s, se ha creado un directorio `node_modules`, donde se almacena el m√≥dulo `chalk`.

Para utilizar el m√≥dulo dentro de un fichero `index.js`:

```javascript
const chalk = require('chalk');
console.log(chalk.blue('Hello, npm!'));
```
Ejecutamos desde el terminal:
.inverse[<pre><span class=codigo>node index<span><span style="color:lightblue;display:block;">Hello npm</span></pre>
]
Toda la funcionalidad se encuentra en la p√°gina de [documentaci√≥n](https://www.npmjs.com/package/chalk) del package. 

!!!IMPORTANTE:: **NUNCA COMMIT DE `node_modules` a GIT**. 

Para recrear el directorio `node_modules` utilizamos el comando __`npm install`__.
---
task: [<< √≠ndice de contenidos >>](#contenido)
#### Utilizando packages npm: Otros comandos

Por defecto NPM instala las dependencias en modo local. Es decir, crea un directorio node_modules dentro del directorio donde estamos ejecutando el comando. 
Se puede usar `npm ls`¬†para listar los m√≥dulos instalados en local.

En la instalaci√≥n global los paquetes se almacenan en el directorio system. Estas dependencias se pueden utilizar con un CLI (Command Line Interface) pero no se pueden importar en la aplicaci√≥n directamente con require()

.inverse[<pre class=codigo>npm install nodemon -g</pre>
]

Para desinstalar un package:.inverse[<pre class=codigo>npm uninstall chalk</pre>
]
Para actualizar un package:.inverse[<pre class=codigo>npm update chalk</pre>
]
Para buscar un package:.inverse[<pre class=codigo>npm search chalk</pre>
]


---
task: [<< √≠ndice de contenidos >>](#contenido)
### Ejercicio 1
<hr>
Instalar un package de la siguiente [lista](https://github.com/sindresorhus/awesome-nodejs#weird), en especial de la secci√≥n "raritos" (_weird_).

Usar el package seleccionado en el archivo `index.js`. 
<br>
<br>
<br>

### Ejercicio 2
<hr>
Importar la librer√≠a ‚Äúos‚Äù

Obtener datos sobre cpu, sistema y servidor

Imprimirlos en el navegador

---
task: [<< √≠ndice de contenidos >>](#contenido)
### Mi primer package npm: Registro


1. Reg√≠strate en [npm](https://www.npmjs.com/signup) para tener una cuenta
2. Desde el [terminal](https://www.davidbaumgold.com/tutorials/command-line/) tecleamos:

.inverse[<pre class=codigo>npm adduser</pre>
]

  Tambi√©n podemos utilizar:
.inverse[<pre class=codigo>npm login</pre>
]

El terminal nos solicita ahora `username`, `password` y `email`. 

En este momento obtenemos un mensaje similar a √©ste:

.inverse[<pre>Logged in as rglepe on https://registry.npmjs.org/</pre>
          ]

Importante!!! Hay que verificar el mail desde la cuenta de correo.
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Mi primer package npm: Preparaci√≥n

Desde un directorio de trabajo, llamaremos a nuestro package __minimalista__ e introduciremos una serie de instrucciones:

.inverse[<pre class=codigo-dir><span class=codigo> md minimalista<span></pre>
]

Entramos al directorio creado:
.inverse[<pre class=codigo-dir><span class=codigo> cd minimalista<span></pre>
]

Para trabajar con npm es necesario definir un archivo de tipo _manifest_, que es un fichero donde se listan todas las dependencias de terceros que tiene nuestro programa. Este archivo es [package.json](https://docs.npmjs.com/files/package.json) :

.inverse[<pre class=codigo> fsutil file createNew package.json 0</pre>
]

Crearemos un package npm con la informaci√≥n imprescindible en el fichero package.json: __nombre__ y __versi√≥n__
.inverse[<pre style="color: red;">{
  "name": "@rglepe/minimalista",<br>  "version": "1.0.0"<br>}</pre>]
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Mi primer package npm: Publicaci√≥n

Para publicar el package npm, corremos la instrucci√≥n:
.inverse[<pre class=codigo>npm publish --access=public</pre>
]
_Por defecto los packages se publican con visibilidad private. Para evitar esto usaremos el modificador `--access=public`_

Una vez ejecutado, aparecer√° un signo "+", el nombre del package y la versi√≥n.
.inverse[<pre>+ @rglepe/minimalista@1.0.0</pre>
]
!!!Ahora ya pertenecemos al __club npm__!!!


Recibiremos tambi√©n un mail:
<img src="https://imgur.com/kJwAabw.png" width=75% height=75%>

Ya tenemos la versi√≥n 1 del package: https://www.npmjs.com/package/@rglepe/minimalista/v/1.0.0
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Package npm completo

Usaremos un repositorio [GitHub](https://github.com/new) al que a√±adiremos un fichero _readme_ con las instrucciones necesarias para utilizar el package y...el c√≥digo del package.

__fichero README!__
<hr>
Vamos a√±adir una serie de etiquetas desde [shields.io](https://shields.io/) de forma que parezca que somos muy profesionales:

Vamos a√±adir la versi√≥n actual del package (npm scoped):

![npm (scoped)](https://img.shields.io/npm/v/@rglepe/minimalista.svg)

Y el tama√±o del package (npm bundled size minified). 

*_Si todav√≠a no hemos introducido el c√≥digo, nos dar√° un error de inaccesible_:

![npm bundled size(minified)](https://img.shields.io/bundlephobia/min/@rglepe/minimalista.svg)
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Package npm completo

__Licencia__
<hr>

Una licencia permite conocer las condiciones de uso de nuestro package existen [muchas diferentes](https://choosealicense.com/).
Dentro del apartado __insights__ de cada repositorio GitHub podemos seleccionar distintos estados ‚Äî incluyendo los recomendados por la comunidad: 

<img src="https://imgur.com/Xt1FtFb.png" class=centered>

Aqu√≠ seleccionamos "Choosing a License", y despu√©s:

<img src="https://imgur.com/3OomQY6.png" class=centered>
---
task: [<< √≠ndice de contenidos >>](#contenido)
          
### Package npm completo

__C√≥digo__
<hr>
Una funci√≥n para eliminar espacios de un string:

    module.exports = function minimalista(string) {
      if (typeof string !== "string") throw new TypeError
      ("Minimalista requiere un string!");
      return string.replace(/\s/g, "");
    };

A√±adimos el c√≥digo dentro de un archivo __index.js__. Este ser√° el _entry point_ a nuestro package.

Completamos nuestro __package.json__ b√°sico y a√±adimos instrucciones al fichero __readme.md__, para explicar el uso de nuestro c√≥digo.
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Package npm completo

__package.json__
<hr>
A√±adimos: 

    {
      "name": "@rglepe/minimalista",
      "version": "1.0.0",
      "description": "Removes all spaces from a string",
      "license": "MIT",
      "repository": "bcncodes-training/minimalista",
      "main": "index.js",
      "keywords": [
        "minimalista",
        "npm",
        "package",
        "bcncodes-training"
      ]
    }
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Package npm completo

__readme.md__
<hr>
A√±adimos instrucciones de c√≥mo utilizar el package. Si necesitas alguna plantilla, √©chale un vistazo a la comunidad y usa alguno de sus formatos para empezar.

<img class="centered" src="https://imgur.com/XSV5iku.png">
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Package npm completo

1. Actualizamos la versi√≥n npm mediante la instrucci√≥n:
.inverse[<pre class=codigo>npm version major</pre>
]

Que genera:          .inverse[<pre>v2.0.0</pre>
]

2. Publicamos:
.inverse[<pre class=codigo>npm publish --access=public</pre>
]

Obtenemos:
.inverse[<pre>+ @rglepe/minimalista@2.0.0</pre>
]
---
task: [<< √≠ndice de contenidos >>](#contenido)

## Utilidades

- [Package Phobia](https://packagephobia.now.sh/result?p=%40rglepe%2Fminimalista) ofrece un resumen del package npm.

- Tambi√©n podemos revisar los ficheros en [Unpkg](https://unpkg.com/@rglepe/minimalista@2.0.2/)

---
task: [<< √≠ndice de contenidos >>](#contenido)
###Ejercicio a entregar: Introducci√≥n a Node
<hr>

Clona la rama del repositorio `github.com/bcncodes-training/intro-node.git` que lleva tu nombre. Una vez completado el ejercicio actualiza tu rama.

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Recursos extras

- [Getting the best out of NPM](https://jsblog.insiderattack.net/getting-the-best-out-of-npm-b73d4a8fbf29#.hehmw1xun) - More advanced NPM concepts


---

name: modulos
class: center, middle, inverse
## [M√≥dulos en Node.js](#Qu√© es Node.js?)
---
name:modulosintro
task: [<< √≠ndice de contenidos >>](#contenido)

### M√≥dulos Node: Intro

Los m√≥dulos en Node.js son funcionalidades simples o complejas organizadas en uno o varios ficheros JavaScript, completamente independientes entre si,  y que pueden ser mezclados, a√±adidos y eliminados, sin alterar el sistema en su conjunto. 

![](https://imgur.com/dSzASCp.png)

---
task: [<< √≠ndice de contenidos >>](#contenido)

### M√≥dulos Node: Ventajas

Sobre todo cuando el sistema crece, y queremos independizar bloques de c√≥digo

__Mantenimiento__, un modulo bien dise√±ado, disminuye al m√°ximo las dependencias, por tanto su crecimiento o redise√±o no afecta a los dem√°s

__Espacios de nombre__, cada m√≥dulo, es capaz de crear sus variables en un espacio privado (tiene contexto propio), sin contaminar al resto de m√≥dulos

__Reutilizaci√≥n__, un m√≥dulo es susceptible de ser usado por diversas aplicaciones en distintos contextos, ya que expone una interficie

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Origen de los m√≥dulos de Node.js: Revealing Module Pattern

- El principio central de este patr√≥n de dise√±o es que todas las funcionalidades y variables deber√≠an estar encapsuladas a menos que se expongan de forma deliverada
- Para implementar el patr√≥n en JavaScript se utilizan los [_closures_](https://developer.mozilla.org/es/docs/Web/JavaScript/Closures) y las [IIFEs](https://developer.mozilla.org/es/docs/Glossary/IIFE)
```javascript
      var modulo = (function() {
        var privMetodo = function() {...};
        var privVariable = [];
        var export = {
        publicMetodo: function() {...},
        publicVar: function() {...}
        }
    
        return export;
        })();
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### M√≥dulos Node: CommonJS

- Es un grupo de trabajo que surge con el objetivo de estandarizar el ecosistema JavaScript y una de sus propuestas fueron los m√≥dulos CommonJS
  
- La librer√≠a CommonJS es, por tanto, la implementaci√≥n del patr√≥n revealing module en javascript

- CommonJS ofrece:

  + Una sintaxis compacta
  + Dise√±o para carga s√≠ncrona
  + Principal uso en servidores

---
task: [<< √≠ndice de contenidos >>](#contenido)
### M√≥dulos Node: Definici√≥n de un m√≥dulo CommonJS

La definici√≥n de un m√≥dulo CommonJS se realiza de la siguiente manera: 
```javascript
    const myModule {

        hello: () => 'hello!';
        goodbye:() => 'goodbye!';
      
    }

    module.exports = myModule;
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### M√≥dulos Node: Utilizaci√≥n de un m√≥dulo CommonJS

Para utilizar el m√≥dulo desarrollado con CommonJS usamos el m√©todo `require()`:

    const myModule = require('myModule');

    myModule.hello(); 
    myModule.goodbye(); 

De este modo, se evita la contaminaci√≥n de namespaces globales, y las dependencias se vuelven mas expl√≠citas.

---
task: [<< √≠ndice de contenidos >>](#contenido)
### M√≥dulos Node: CommonJS en Node

- Node lleva incorporado en el core a CommonJS como sistema de m√≥dulos

- En NodeJS cada fichero .js es tratado como un m√≥dulo separado

- Los m√≥dulos __se cargan en memoria__ una vez y luego __son reutilizados__
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Dise√±o modular: Carga de m√≥dulos NodeJS

Node.js puede cargar dependencias utilizando la palabra clave ‚Äúrequire‚Äù y asignando el m√≥dulo cargado a una variable, como se puede ver en el ejemplo:

    const http = require('http'); 
    const dns = require('dns');


Tambi√©n se pueden cargar archivos en rutas relativas:

    const myFile = require('./myFile');


Si se instalan m√≥dulos desde npm, se manejan como los nativos, sin necesidad de especificar la ruta absoluta o relativa:

      const express = require('express');

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Dise√±o modular: Exportar desde m√≥dulos NodeJS

Los m√≥dulos en Node.js no se inyectan autom√°ticamente en el √°mbito global, sino que simplemente se asignan a una variable. 

Para exportar funciones o variables de un m√≥dulo se utiliza el objeto __`module.exports`__ o __`exports`__. 
- __Exports__ es un objeto especial que se incluye en todos los ficheros JS de Node, por defecto. 
- __module__ es una variable que representa el m√≥dulo actual y 
- __exports__ es un objeto que se expondr√° como m√≥dulo
```javascript
      // book.js
      module.exports.name = 'pepe'; //asigna un valor al m√≥dulo
      module.exports.read = function() { 
      console.log('Hola ' + exports.name);
      } 
      //asigna una funci√≥n a la propiedad read del objeto exports 
      //devuelve el objeto {read: function(){...}}
```
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Dise√±o modular: Exportar desde m√≥dulos NodeJS

Con `module.exports` se puede exportar cualquier tipo de objetos, por ejemplo clases:

      // book.js
      module.exports = class book {
      public name;
      constructor(name){this.name = name};
      read = function() { 
      console.log('Hola ' + this.name);
      }}
---
task: [<< √≠ndice de contenidos >>](#contenido)
### Dise√±o modular: Exportar desde m√≥dulos NodeJS

Ejemplos de buenos y malos usos de `exports`:

      // calculator-exports-examples.js

      // good
      module.exports = {
        add(a,b) { return a+b }
      }

      // good
      module.exports.subtract = (a,b) => a-b

      // valid
      exports = module.exports

      // good and simply a shorter version of the code above
      exports.multiply = (a,b) => a*b

      // bad, exports is never exported
      exports = {
        divide(a,b) { return a/b }
      }

---
task: [<< √≠ndice de contenidos >>](#contenido)
### Dise√±o modular: ES Modules

Un m√≥dulo ES6 es un archivo que contiene c√≥digo JS. No existe una palabra clave `module`; un m√≥dulo se lee casi como cualquier script. Existen dos diferencias.

Se puede usar `import` y `export` en los m√≥dulos.

Se puede hacer `export` de cualquier `function`, `class`, `var`, `let`, o `const` declarado al nivel m√°s alto del script.

      //kittydar.js - Encontrar todos los gatos en una imagen.

      export function detectCats(canvas, options) {
        var kittydar = new Kittydar(options);
        return kittydar.detectCats(canvas);
      }

      export class Kittydar {
        //... varios m√©todos de procesamiento de im√°genes ...
      }

      // esta funci√≥n no ser√° exportada.
      function resizeCanvas(){
        ...   }
Si queremos exportar todo el m√≥dulo podemos asignar: __`export default`__.

---
task: [<< √≠ndice de contenidos >>](#contenido)
### Dise√±o modular: ES Modules

En un archivo separado, podemos importar y usar la funci√≥n detectCats():

    //demo.js - Programa demo Kittydar

    import {detectCats} from "kittydar.js";

    function go(){
      var canvas = document.getElementById("catpix");
      var cats = detectCats(canvas);
      drawRectangles(canvas, cats);
    }
Para importar m√∫ltiples nombre de un m√≥dulo, se escribir√≠a:

    import {detectCats, Kittydar} from "kittydar.js"

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Dise√±o modular: ES Modules en NodeJS

En NodeJS los m√≥dulos ES se encuentran en fase experimental hasta que entre en lts la versi√≥n 12. 
Para trabajar con ellos, de momento se requiere crear un fichero con la extensi√≥n `.mjs` y activarlo con el flag `--experimental-modules`:

.inverse[<pre class=codigo> node --experimental-modules my-app.mjs</pre>
]

Para exportar un m√≥dulo se escribir√≠a:

      //01-kettle.mjs
      export const spout = 'the spout'
      export const handle = 'the handle'
      export const tea = 'hot tea

Para usarlo en otro m√≥dulo 01-main.mjs

      import {handle, spout, tea} from './01-kettle.mjs'

      console.log(handle) // ==> the handle
      console.log(spout) // ==> the spout
      console.log(tea) // ==> hot tea

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Diferencias CJS Modules vs MJS Modules

- L√≥s m√≥dulos ES6 se cargan de forma as√≠ncrona, mientras que los CJS se cargan de forma s√≠ncrona.

- Los modulos ES6 son un est√°ndar multiplataforma, son compatibles con Node.js y navegadores.
  
- Los Imports y Exports en ES6 son est√°ticos. Permite utilizar s√≥lo la parte √∫til cuando se usan librer√≠as de terceros.

- En CJS los imports son din√°micos, requieren asignarlos a una variable. Esto ralentiza la carga de los m√≥dulos.

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Notas sobre el dise√±o modular

1. Al empezar a dise√±ar m√≥dulos, dos conceptos clave del desarrollo software: __cohesi√≥n__ y __desacoplamiento__. Hay que¬†crear m√≥dulos que se encuentren muy cohesionados. 
   
  + Los m√©todos dentro de un m√≥dulo deben tener una relaci√≥n¬†interna

  + Cuanto m√°s __cohesionado__ se encuentran los miembros de un m√≥dulo, mayor __reutilizaci√≥n__, __mantenimiento__ y __evoluci√≥n__ podr√≠a llegar a tener,¬†en t√©rminos generales.

  +  El¬†concepto de __acoplamiento__, tiene que ver con el __n√∫mero de dependencias__ que un m√≥dulo tiene con otros m√≥dulos.¬†
  
2. Todo m√≥dulo, para que est√© bien dise√±ado, deber√≠a¬†cumplir con el principio de __√∫nica responsabilidad__. 
  
  + Puede ser complicado y depende de muchos par√°metros del contexto.
  
  + Cuantas m√°s dependencias tiene un m√≥dulo m√°s dif√≠cil de testear y m√°s expuesto a cambios en el¬†futuro podr√≠a estar.

  + Como, no depender de nada, no es posible, tendremos que crear formas en las que incluir esas dependencias nos generen la menor fricci√≥n posible.
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Notas sobre el dise√±o modular

- Tenemos que intentar que dentro de nuestro √°rbol de dependencias, los m√≥dulos que se encuentren en la parte m√°s profundas (en la ra√≠z) sean lo m√°s gen√©ricos posibles y que seg√∫n nos acerquemos a las hojas, los m√≥dulos sean m√°s espec√≠ficos.
- En capas superiores, el c√≥digo ¬†se encuentra ya muy ligado a la l√≥gica de nuestro negocio y esto nos obliga a que tenga que ser as√≠. 

- Para conseguir desacoplar el c√≥digo hay que utilizar la inyecci√≥n de dependencias: [https://www.npmjs.com/search?q=dependency%20injection](https://www.npmjs.com/search?q=dependency%20injection)

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejercicio 3
<hr>

- Crear un m√≥dulo para importar la librer√≠a ‚Äú`os`‚Äù y obtener datos sobre cpu, sistema y servidor

- Crear otro m√≥dulo para Imprimir los datos obtenidos en el paso anterior, en el navegador.

TIPs: Utilizar _backticks_ (`tildes francesas`) para incluir variables: `${}`

BONUS: Mismo ejercicio en ES Modules

<br>

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejercicio 4
<hr>

Guardar los datos anteriores en un fichero.

TIPS: Utilizar el m√©todo `appendFile()` del m√≥dulo `fs`. Requiere 3 par√°metros:
- _Nombre fichero_,
- _Contenido_
- Funci√≥n `callback`: 
    
    function(error) {if(error){console.log('se ha producido un error');}}

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejercicio 5

- Crea un m√≥dulo que encapsule el procesado de strings para generar procesos:

  + Primera may√∫scula
  + Tipo Oraci√≥n
  + Min√∫sculas
---
name: callbacks
class: center, middle, inverse
## [Callbacks](#Qu√© es Node.js?)
---
task: [<< √≠ndice de contenidos >>](#contenido)

### callbacks: conceptos

- En JavaScript se usa la notaci√≥n __CPS__ (abreviatura de _continuation passing style_) para escribir el c√≥digo de un programa en el que las Continuaciones se escriben y se pasan de forma expl√≠cita.

- Cuando se escribe un programa en notaci√≥n CPS, cada funci√≥n recibe un par√°metro adicional, que representa la Continuaci√≥n de la funci√≥n. En lugar de retornar, la funci√≥n invocar√° la continuaci√≥n recibida pasando el valor de retorno. De esta forma, las funciones nunca regresan al c√≥digo que las llam√≥, sino que la ejecuci√≥n del programa transcurre ‚Äúhacia adelante‚Äù sin retornar hasta que el programa finalice.
  
- CPS es un concepto general y no siempre est√° asociado a programaci√≥n as√≠ncrona.

---
task: [<< √≠ndice de contenidos >>](#contenido)

### callbacks: conceptos

- Las funciones callbacks, por tanto, sustituyen a la instrucci√≥n __return__ que requiere la ejecuci√≥n s√≠ncrona.

- En Node todas las APIs soportan el uso de callbacks:


    //CallBacks en programaci√≥n s√≠ncrona
    function add(a, b, callback) { callback(a + b);
    }
    console.log('before'); add(1, 2, function(result) {
       console.log('Result: ' + result);
    });
    console.log('after');
    //Resultado
    before Result: 3 after


    //CallBacks en programaci√≥n as√≠ncrona
    function addAsync(a, b, callback) { setTimeout(function() { callback(a + b);
    }, 100); }
    console.log('before'); addAsync(1, 2, function(result) { 
      console.log('Result: ' + result);
      }); console.log('after');
    //Resultado before after Result: 3

---
task: [<< √≠ndice de contenidos >>](#contenido)

### callbacks: conceptos

Ejemplo: Lectura de un fichero en modo s√≠ncrono:

Crear un fichero input.txt con un texto de prueba, en el directorio de un proyecto: ejemploCallBacks
Crear un fichero main.js que importe el m√≥dulo fs
Volcar el contenido del fichero a una variable con el m√©todo: 

    let data = fs.readFileSync('input.txt');

Imprimir el contenido del fichero por consola.
Imprimir un mensaje por consola ('Fin del programa').

---
task: [<< √≠ndice de contenidos >>](#contenido)

### callbacks: conceptos

Ejemplo: Lectura de un fichero en modo as√≠ncrono:

Crear un fichero input.txt con un texto de prueba, en el directorio de un proyecto: ejemploCallBacks
Crear un fichero main.js que importe el m√≥dulo fs 
Leer el fichero con el m√©todo: 


    let fs.readFile('input.txt', (err, data) => {
      if (err) return console.error(err); console.log(data.toString());
        });
      ;

Imprimir el contenido del fichero por consola.
Imprimir un mensaje por consola ('Fin del programa').

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Convenciones de Callbacks en NodeJS 

- Las funciones _callback_ siempre son el √∫ltimo argumento de la funci√≥n. Ej:


      fs.readFile(filename, [options], callback)

- Los errores siempre se sit√∫an al principio de la funci√≥n _callback_ y deben ser del tipo `Error`. Ej: 


      fs.readFile('foo.txt', 'utf8', function(err, data) {
          if(err){
            handleError(err);
          } else {
            processData(data);
          }
      });
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Convenciones de Callbacks en NodeJS 

- En CPS as√≠ncrono los errores se tienen que propagar a la siguiente funci√≥n de callback. Ej:


    const fs = require('fs');

    const readJSON = (filename, callback) => {
      fs.readFile(filename, 'utf8', (err,data)=>{
        
        let parsed;
        
        if(err)
        //propagate the error and exit the current function
        return callback(err);

        try {
          //parse the file contents
          parsed = JSON.parse(data);
        } catch(err) {
        // catch parsing errors
        return callback(err);
        }
        // no errors, propagate just the data

        callback(null, parsed);
      });
    };
---
### Ejercicio5
<hr>
- Crear una funci√≥n que pase el contenido de un array a un callback y √©ste genere un nuevo array que multiplique cada valor del array anterior por 2.
 
 TIPS: imitar a la funci√≥n `Array.map()`


---

name: promesas
class: center, middle, inverse
## [Promesas](#Qu√© es Node.js?)
---

name:promesas
task: [<< √≠ndice de contenidos >>](#contenido)

### Promesas: Intro

Una `promesa` es un objeto que representa la __finalizaci√≥n con √©xito o con fallo__ de una __operaci√≥n as√≠ncrona__. En esencia, una promesa es un objeto retornado al cual se le pueden asignar _callbacks_, en lugar de pasar un _callback_ a una funci√≥n

Es un recurso para manejar un proceso √°sincrono de manera s√≠ncrona. Representa un valor que podemos manejar en alg√∫n momento, en el futuro de forma m√°s sencilla que los _callbacks_

Una promesa puede ser creada en el c√≥digo o puede ser devuelta por un package node externo

???
---
task: [<< √≠ndice de contenidos >>](#contenido)

### C√≥mo crear Promesas

Se crean utilizando el operador new sobre el objecto __`Promise`__ pasando como √∫nico parametro una funci√≥n ejecutora. Esta funci√≥n a su vez recibe dos parametros: un _callback_ que ser√° ejecutado cuando la promesa se ha cumplido (__resolve__) y otro que ser√° ejecutado cuando no (__reject__).

La l√≥gica de programaci√≥n debe controlar cu√°ndo y d√≥nde llamar a esas funciones. Si la operaci√≥n tiene √©xito se pasan los datos al c√≥digo que usa la promesa si no, se pasa el error.

```javascript
const miPromesa = new Promise(function(resolve, reject) { 

   if (/* condition */) {
      resolve(/* value */);  // fulfilled successfully
   }
   else {
      reject(/* reason */);  // error, rejected
   }
});
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Estados de las promesas

De este modo, la `promesa` tiene tres estados:

- **Pendiente**. Hasta que se resuelve, permanece en estado pendiente
- **Completada**. Cuando se invoca la funci√≥n `resolve` con el valor devuelto.
- **Rechazada**. Si se invoca la funci√≥n `reject` con un valor de rechazo.

**Una `Promesa` solo puede ser completada o rechazada una vez.**

Una `Promesa` tambi√©n se puede resolver de forma inmediata utilizando el m√©todo **`Promise.resolve()`**

```javascript=
let myMeth = Promise.resolve(42);  
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Consumir Promesas: `.then()`

Una vez tengamos la promesa, se puede pasar como **valor**. La promesa es una respresentaci√≥n del valor futuro, y puede ser devuelta a partir de una __funci√≥n__, pasada como __par√°metro__ y usada como cualquier otro valor

**Para consumir la `promesa`** - *es decir, utilizar el valor una vez que se ha completado* - asociamos una __funci√≥n__ que gestione la promesa usando el m√©todo __`.then()`__.

```javascript=
let p = new Promise((resolve, reject) => resolve("BCNcodes"));  
p.then((val) => console.log(val)); // BCNcodes  
```

El m√©todo **`.then()`** recibe **dos par√°metros posibles**. 

- El primero es la funci√≥n que se invocar√° si la promesa se ha completado.
- El segundo es la funci√≥n que se invocar√° si la promesa se ha rechazado.
- 
```javascript=
p.then((val) => console.log("fulfilled:", val),  
       (err) => console.log("rejected: ", err));
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Consumir Promesas: `.catch()`

üëÄ: Si se omite el primer par√°metro del m√©todo `.then()`, enviando un `null`, ser√≠a equivalente a encadenar el m√©todo __`Promise.catch()`__, que toma como √∫nico par√°metro la llamada del rechazo de la promesa.

Son equivalentes:

```javascript=
p.then((val) => console.log("fulfilled:", val))  
 .catch((err) => console.log("rejected:", err));

p.then((val) => console.log("fulfilled:", val))  
 .then(null, (err) => console.log("rejected:", err));
```
Como se ve, la funci√≥n `.then()` devuelve a su vez una promesa permitiendo que sean encadenadas facilmente. Adem√°s el valor que se devuelve en `.then()` se pasa como par√°metro al siguiente.

Mejor utilizar **`.catch()`** para gestionar los errores que la expresi√≥n __`.then(null, function)`__. __`.catch()`__ es m√°s expl√≠cito y se puede encadenar al final de una cadena de promesas, devolviendo cualquier excepci√≥n o rechazo de la promesa original o de cualquiera otra. 

???
## Dealing with errors

You should use **`.catch()`** for *handling errors*, rather than `.then(null, function)`. Using **`.catch()`** is more explicit and idiomatic, and when chaining you can have a single `.catch()` at the end of the chain to handle **any rejection or thrown exceptions** from either the original promise or any of it's handlers.

Throwing an exception in a `Promise` will automatically **reject** that `Promise` as well. This is the same for `.then()` handlers and their **results** and **return** values as well. A thrown error is wrapped in a `Promise` and treated as a rejection.
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Encadenamiento de promesas

```javascript=
var p1 = new Promise((resolve, reject) => {  
  if (true)  
    throw new Error("rejected!"); 
  else
    resolve(4);
});

p1.then((val) => val + 2)  
 .then((val) => console.log("got", val))
 .catch((err) => console.log("error: ", err.message));
// => error: rejected!
```

![](https://imgur.com/pndfvfg.png)
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo Promesa 
_(https://scotch.io/tutorials/javascript-promises-for-dummies)_

Imagina que eres peque√±@ y tu madre te promete que te regalar√° un m√≥vil nuevo si te portas bien. 

Creamos la promesa:

```javascript
const isMomHappy = true;
const willIGetNewPhone = new Promise((resolve, reject) => { 
    if (isMomHappy) {
        const phone = {
          brand: 'Samsung',
          color: 'black'
        };
        resolve(phone);
    } else {
        const reason = new Error('mom is not happy');
        reject(reason);
    }
});
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo Promesa 
_(https://scotch.io/tutorials/javascript-promises-for-dummies)_

Llamamos a la promesa:

```javascript
const askMom = function() { 
   willIGetNewPhone
      .then(console.log)
      .catch( error =>console.log(error.message));
}

askMom();
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo Promesa 
_(https://scotch.io/tutorials/javascript-promises-for-dummies)_

Ahora prometes que si tienes un m√≥vil nuevo se lo ense√±ar√°s a tus amigos. A√±ades otra promesa

```javascript
const showOff = function (phone) {
  const message = 
      `Hey friend, I have a new ${phone.color} ${phone.brand} phone` ;

  return Promise.resolve(message);
};
// call our promise
const askMom = function () {
  willIGetNewPhone
    .then(showOff)
    .then(fulfilled => console.log(fulfilled)) // fat arrow
    .catch(error => console.log(error.message)); // fat arrow
};

askMom();
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

###Ejercicio 6

<hr>

Crear una operaci√≥n que devuelva el resultado de una suma as√≠ncrona en una promesa. Despu√©s elevar al cuadrado el resultado.

- Si alg√∫n sumando es 0 devolver√° error.
- Si el resultado de la potencia es mayor que 100 devolver√° error.

---
###Ejercicio node-meQuiere-noMeQuiere

<hr>

Deshoja la margarita y descubre si tu amad@ te quiere o no te quiere.

### Descripci√≥n

- Part√≠s de una margarita de n√∫mero variable de p√©talos.
- Deshojar la margarita significa arrancarle un p√©talo cada segundo (tip: pensad en setInterval())
- Cada p√©talo __"arrancado"__ significa imprimir en pantalla "me quiere!" o "no me quiere!!!".
- El programa resolver√° con el valor √∫ltimo pintado en _AZUL_ si me quiere o en _ROJO_ si no me quiere (tip: chalk)

### Detalles

Devuelve una promesa con el mensaje que toque y encadena la impresi√≥n por la consola.
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Promesas: M√©todos est√°ticos

- **`Promise.resolve`**: Crea una promesa de cumplimiento
```javascript
let promise = Promise.resolve(valor);
```

- **`Promise.reject`**: Crea una promesa de rechazo
```javascript
let promise = Promise.reject(error);
```

- **`Promise.all`**: Ejecuta muchas promesas en paralelo y espera hasta que todas ellas han terminado. El iterador normalmente es un array que devuelve una promesa. Si se rechazan se devuelve el argumento de la primera promesa que se rechaza. Es un m√©todo √∫til para agregar el resultado de m√∫ltiples promesas.

```javascript
Promise.all([
new Promise((resolve, reject) => setTimeout(() => resolve(1), 3000)),// 1
new Promise((resolve, reject) => setTimeout(() => resolve(2), 2000)),// 2
new Promise((resolve, reject) => setTimeout(() => resolve(3), 1000))// 3
]).then(console.log); 
//1,2,3 when promises are ready: each promise contributes an array member
```

???

## Promises All

There will be sometime we will need to wait more than one `Promise` to complete to continue our program, no worries, you can use `Promise.all()`:wink:

The **`Promise.all()`** method returns a single `Promise` that **resolves when all of the promises in the iterable argument have resolved** or when the iterable argument contains no promises. It **rejects with the reason of the first promise that rejects.** This method can be useful for aggregating the results of multiple promises.

**Fulfillment**
- If an empty iterable is passed, then this method returns (synchronously) an already resolved promise.
- If all of the passed-in promises fulfill, or are not promises, the promise returned by `Promise.all` is fulfilled asynchronously.
- In all cases, the **returned promise is fulfilled with an array containing all the values of the iterable passed as argument (also non-promise values).**

**Rejection**
If any of the passed-in promises **reject**, `Promise.all` asynchronously rejects with the value of the **promise that rejected**, whether or not the other promises have resolved.

```javascript=
var p1 = Promise.resolve(3);
var p2 = 1337;
var p3 = new Promise((resolve, reject) => {
  setTimeout(resolve, 100, 'foo');
}); 

Promise.all([p1, p2, p3]).then(values => { 
  console.log(values); // [3, 1337, "foo"] 
});
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### Promesas est√°ticas: Promise.all

Una estrategia utilizada es mapear un array de datos a un array de promesas y despu√©s envolverlo con Promise.all. Ej:

```javascript
let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'https://api.github.com/users/jeresig'
];
// map every url to the promise fetch(github url)

let requests = urls.map(url => fetch(url));

// Promise.all waits until all jobs are resolved

Promise.all(requests)
       .then(responses => responses.forEach(
        response => alert(`${response.url}: ${response.status}`)
));
```

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Visualizaci√≥n gr√°fica de las promesas

```javascript=
Promise.all([
  new Promise(resolve => setTimeout(resolve, 1500)),
  new Promise(resolve => setTimeout(resolve, 900)),
  new Promise(resolve => setTimeout(resolve, 2200))
])
.then(results => results.length.b.c)
.then(c => console.info(c))
.catch(err => console.error(err))
```
<img src="https://imgur.com/f6ii7GH.png" width=50% height=50%>

La web [Promises Visualization](https://bevacqua.github.io/promisees/#) permite comprobar de forma gr√°fica como se resuelven las promesas despu√©s de cada `setTimeout`.
???
Go ahead and play around with the different methods of `Promise`! :muscle: 

## Summary

We just learn a super powerfull tool for dealing with asynchrnous code. `Promises` give us the ability to write asynchronous code in a synchronous fashion, with flat indentation and a single exception channel.

`Promises` give us guarantees of no race conditions and immutability of the future value represented by the `Promise` (unlike callbacks and events). 


---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejercicio 7
<hr>

Recorrer un directorio manejando la respuesta de si es un fichero o un directorio con promesas. 

- Si es un fichero concatenar el nombre del fichero al directorio
- Si es un directorio volver a invocar a la funci√≥n.
- Obtener el resultado por consola.

---

name: asyncawait
class: center, middle, inverse
## [async|await](#Qu√© es Node.js?)

---
name: introasync
task: [<< √≠ndice de contenidos >>](#contenido)

### async|await

Desde ES7 y nodejs > 6 se introduce la expresi√≥n `async`/`await` se utiliza para manejar la asincron√≠a:
- __`async`__ delante de una funci√≥n significa que esa funci√≥n devolver√° una promesa.

  ```javascript
  async function f(){return 1;}
    f().then(console.log);
  //es igual a async function f() {return Promise.resolve(1)}
  ```
- __`await`__ trabaja s√≥lo con funciones `async` y lo que hace es parar la ejecuci√≥n del programa hasta que se completa la funci√≥n `async`.

```javascript
async function f() {
    let promise = new Promise((resolve, reject) => {
    setTimeout(() => resolve("done!"), 1000)
  });

  let result = await promise; // wait till the promise resolves (*)
  console.log(result); // "done!"
}

f();
```
---
task: [<< √≠ndice de contenidos >>](#contenido)

### async|await: Manejo de errores

Manejar los errores con **`try-catch`**

```javascript
async function f() {
  try {
    let response = await fetch('/no-user-here');
    let user = await response.json();
  } catch(err) {
    // catches errors both in fetch and response.json
    alert(err);
  }
}

f();
```
---
### Ejercicio 8
<hr>

Rehacer el ejemplo del "m√≥vil nuevo" con async/await

---
[_Volver al Men√∫ Principal_](/courses/meanstack/content.html)

---
name: eventemitter
class: center, middle, inverse
## [Event-Driven Programming](#Qu√© es Node.js?)
---

name:eventemitterintro
task: [<< √≠ndice de contenidos >>](#contenido)

### EDP: Intro

La __programaci√≥n orientada a eventos__ es un paradigma de programaci√≥n en el cual el flujo del programa viene determinado por eventos tales como acciones de usuario (clicks del _mouse_, presi√≥n de teclas), salidas de sensores o mensajes de otros programas o hilos de ejecuci√≥n.

Node usa un model orientado a eventos manejado por una librer√≠a llamada __`libuv`__ que proporciona un mecanismo llamado __event loop__.

_El comportamiento es muy parecido al del JavaScript del navegador_

.center[![](https://imgur.com/Yq2Tqwb.png)]
---
name:eventemitterintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Event Loop

- Es un √∫nico subproceso que realiza todas las operaciones de entrada y salida (I/O) de forma as√≠ncrona

- Es una cola de funciones. Cuando se ejecuta una funci√≥n as√≠ncrona, la funci√≥n devuelve el c√≥digo interno de la funci√≥n, lo envuelve y se inserta en una cola

- El motor de JavaScript manda las operaciones a la cola y hace que se procesen en segundo plano para no bloquear las dem√°s operaciones

- La librer√≠a `libuv`, proporciona la manera de a√±adir las operaciones necesarias a la cola de forma as√≠ncrona (conocida como threadpool ) y estas operaciones corren de forma nativa en el SO.
---
name:eventemitterintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Event Loop: Proceso

El funcionamiento se da de la siguiente
manera:
1. Existe una cola de tareas
2. Se define el n√∫mero de hilos
3. Cada hilo toma una tarea y la ejecuta
4. Una vez que la tarea est√© completa, se disparar√° otra
5. Si no hay tareas, el subproceso permanece inactivo
6. Si encuentra una nueva tarea en cola se inicia el procesamiento

![](https://imgur.com/jORwIlk.png)
---
### Referencias:

_[Entendiendo la magia detr√°s de node.js y su event loop](https://blog.nearsoftjobs.com/entendiendo-la-magia-detr%C3%A1s-de-nodejs-y-su-event-loop-8335e3b35e58)_

---
### Patr√≥n Observer

- Define un objecto llamado subject que puede notificar a un grupo de observers (o listeners ) cuando ocurre un cambio de estado
- La diferencia principal con el patron de callback es que el sujeto puede notificar a muchos observadores mientras que un callback es el √∫nico listener de la finalizaci√≥n de una tarea as√≠ncrona.
- Las funciones que escuchan los eventos act√∫an como observadores. Cada vez que un evento se dispara, su funci√≥n de escucha comienza a ejecutarse.
- Node.js tiene varios eventos incorporados disponibles a trav√©s del m√≥dulo de `events` y la clase `EventEmitter` que se utilizan para vincular eventos y _events listeners_.
---

### Event Emitter

Crear un objeto `eventEmitter`:

    //M√≥dulo de eventos de importaci√≥n

    import {EventEmitter} from 'events';

    const eventEmitter = new EventEmitter();

Enlazar un controlador de eventos con un evento:

    //Vincular evento y controlador de eventos

    eventEmitter.on ('eventName', eventHandler);

Lanzar un evento program√°ticamente de la siguiente manera:

    eventEmitter.emit('eventName');

---

### Event Emitter: Ejemplo

    import {EventEmitter} from 'events';

    const eventEmitter = new EventEmitter();

    //Create an event handler as follows

    const connectHandler = () => {

          console.log('connection succesful.');
      // Fire the data_received event
          eventEmitter.emit('data_received'); 
    }

    // Bind the connection event with the handler
    
    eventEmitter.on ('connection', connectHandler);

    //Bind the data_received event with the anonymous function

    eventEmitter.on('data_received', ()=>{
        console.log('data received succesfully .');
        });

    // Fire the connection event

    eventEmitter.emit ('connection');
    console.log("Program Ended");

---
### Ejercicio 8
<hr>
- Crear un objeto __EventEmitter__ que emita la fecha actual (`Date.now()`) dentro de una funci√≥n `setInterval()` cada medio segundo.

- Asociar un listener a este evento que imprima la fecha por consola

Realizar el ejercicio anterior con _callbacks_

### Bonus track

Crear una funci√≥n que acepte un __callback__ y devuelva un `EventEmitter`

---

### Ejercicio 9
<hr>

Crear un objeto __`event emitter`__ que emita un evento al que suscribir dos _listeners_:
  - El primer listener imprimir√° del 1 al 100 cada medio segundo
  - El segundo listener imprimir√° del 100 al 1 cada segundo
El programa terminar√° cuando los dos contadores impriman el mismo n√∫mero.
---
name: buffers
class: center, middle, inverse
## [Buffers](#Qu√© es Node.js?)
---

name:buffersintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Buffers

- Conjuntos de datos en crudo (_raw data_), datos binarios, que podemos tratar en NodeJS para realizar diversos tipos de acciones
- Son instancias para almacenar datos sin procesar similares a una matriz de n√∫meros enteros

- En Node.js se implementan mediante una clase espec√≠fica llamada __`Buffer`__

- Se utilizan en la comunicaci√≥n bidireccional que tenemos cuando manejamos sockets, pero tambi√©n al manipular im√°genes o streams de datos. 

---
name:buffersintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Crear un Buffer

- La clase __`Buffer`__ es global en NodeJS, por lo que no necesita ser importada de ning√∫n m√≥dulo para poder usarla. 

- El tama√±o de un buffer se establece en el momento de su creaci√≥n y luego ya no es posible cambiarlo.

- Para crear un buffer: 


    let b1 = Buffer.alloc(20);

  _crea un buffer con tama√±o de 20 bytes sin contenido. Cada uno de sus bytes estar√° inicializado a cero_

- Para crear un buffer con contenido:


    var b2 = Buffer.from('Ejemplo de buffer');
    
- En este caso la codificaci√≥n por defecto es 'utf8'

---

name:buffersintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Buffer: Escribir en una cadena

    buffer.write(string[, offset][, length][, encoding])

Descripci√≥n de los par√°metros utilizados:
- __`String`__: Esta es la cadena de datos que se escribir√° en el buffer.
- __`Offset`__: Este es el √≠ndice del buffer para comenzar a escribir en un punto establecido, el valor predeterminado es 0.
- __`Length`__: Este es el n√∫mero de bytes a escribir.
- __`Encoding`__: Codificaci√≥n a utilizar. 'Utf8' es la codificaci√≥n predeterminada.

__Valor del retorno__: Este m√©todo devuelve el n√∫mero de octetos escritos. Si no hay suficiente espacio en el buffer para ajustar la cadena entera, escribir√° solo una parte de la cadena (hasta donde alcance el espacio).
---

name:buffersintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Buffer: Lectura

    buf.toString([encoding][, start][, end])

Descripci√≥n de los parametros utilizados:

- __`Encoding`__: Codificaci√≥n a utilizar. 'Utf8' es la codificaci√≥n predeterminada.

- __`Start`__: √çndice inicial para empezar a leer, el valor predeterminado es 0.

- __`End`__: El √≠ndice final de la lectura, por defecto es el buffer completo.

__Valor del retorno__: Este m√©todo decodifica y devuelve una cadena de datos lo que esta escrito en el buffer.
---

name:buffersintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Buffer: Concatenar buffers

    Buffer.concat(list[, totalLength])

Descripci√≥n de los parametros utilizados:

- __`list`__: Lista array de objetos de los buffers a concatenar.

- __`TotalLength`__: √âsta es la longitud total de los buffers cuando est√°n concatenados.

---

### Ejercicio 10
<hr>

Crea un buffer de '__Hola Mundo__' convi√©rtelo a min√∫sculas y extrae el espacio. Deber√° quedar: 

    //holamundo

---
name: streams
class: center, middle, inverse
## [Streams](#Qu√© es Node.js?)
---

name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Streams

Objetos que permiten leer datos de una Fuente o escribir datos en un destino en modo continuo:

Cuatro tipos de streams:

__`Readable`__ ‚àí Streams de lectura

__`Writable`__ ‚àí Streams de escritura

__`Duplex`__ ‚àí Stream de lectura/escritura

__`Transform`__ ‚àí A type of duplex stream where the output is computed based on input.

Cada tipo de `Stream` es una instancia de `EventEmitter` y emiten distintos _events_ en diferentes instantes de tiempo. Los eventos m√°s comunes son:

__`data`__ ‚àí Evento de datos disponibles para lectura

__`end`__ ‚àí Evento de no hay m√°s datos de lectura

__`error`__ ‚àí Error recibiendo o escribiendo datos

__`finish`__ ‚àí Finalizaci√≥n de la tarea

---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)
### Streams: Ejemplo de Lectura

- Crear un `stream` a partir de la lectura de un fichero utilizando el m√©todo `createReadStream()` del objeto `fs`:


    import fs from 'fs';
    const streamLectura = fs.createReadStream('./archivo-texto.txt');

- Asociar un evento "__data__" a un _listener_ que se ejecutar√° cuando el dato se haya le√≠do y se encuentre disponible, recibiendo como par√°metro un buffer de datos


    streamLectura.on('data', chunk => //chunk es un buffer de datos
      console.log(chunk instanceof Buffer)); //escribe "true" por pantalla

- Leemos su contenido:


    streamLectura.on('data', chunk =>{ 
        console.log('He recibido ' + chunk.length + ' bytes de datos.');
        console.log(chunk.toString());
    });

---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)
### Ejercicio 11
<hr>
Leer el fichero `movieDetails.json` y mostrar el contenido por consola. Asociar listeners a cada uno de los eventos: data, end, error 
---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### `process`

El m√≥dulo __`process`__ permite obtener informaci√≥n y modificar el proceso en curso de Node. Al contrario que la mayor√≠a de los m√≥dulos, `process` es global y siempre est√° disponible.

### process events

`process` es una instancia de EventEmitter. 
- El evento __`exit`__ proporciona un espacio de ejecuci√≥n final antes de salir de Node. El _event loop_ ya no corre despu√©s de un evento `exit`


    process.on('exit', function () {
      setTimeout(function () {
      console.log('This will not run');
      }, 100);
      console.log('Bye.');
    });

Otros eventos interesantes: `uncaughtException`

---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### process: Operating system input/output

`process`proporciona una serie de `streams` para interaccionar con el sistema operativo: 

__`process.stdin`__
Es un `stream`de lectura. Todo lo que escribimos por el terminal,se lee con `stdin`. Est√° siempre accesible aunque en modo pausa (Node puede escribir, pero nosotros no podemos leerlo). Para poder utilizarlo es necesario invocar el m√©todo `resume()`


    process.stdin.resume();
    process.stdin.setEncoding('utf8');

    process.stdin.on('data', function (chunk) {
      process.stdout.write('data: ' + chunk);
    });

    process.stdin.on('end', function () {
      process.stdout.write('end');
    });
---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### process: Operating system I/O

__`process.stdout`__

Es un stream de escritura con el que se puede generar salida del programa. En este caso la consola. 

    process.stdout.write(objetoBuffer);

- Mediante el m√©todo `write()` se escribe en un `stream` de escritura. Hay que enviarle un buffer y otra serie de par√°metros opcionales como el tipo de codificaci√≥n y una funci√≥n _callback_ a ejecutar cuando termine la operaci√≥n de escritura.


    process.stdin.setEncoding('utf8');
    process.stdout.write('¬øC√≥mo est√°s hoy? ');
    process.stdin.once('data', function(res) {
    process.stdout.write('Has respondido: ');
    process.stdout.write(res);
    process.stdin.pause();
    })
---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### process: Operating system I/O

__`process.argv`__

__`argv`__ es un array que contiene argumentos de la l√≠nea de comandos. Comienza con el propio comando node:

    node argv.js -t 3 -c "abc def" -erf       foo.js
    [ 'node',
      '/Users/croucher/argv.js',
      '-t',
      '3',
      '-c',
      'abc def',
      '-erf',
      'foo.js' ]

---
### Ejercicio 12
<hr>

- Reescribir el ejercicio anterior utilizando la propiedad `stdout` en lugar de `console.log`

- Incorporar una petici√≥n mediante `stdin` para bajar el fichero. 

- Combinar la salida por consola con los m√©todos de la propiedad `process.stdin` para entrar informaci√≥n por consola. 

- Usar la interface `readline` para los objetos `stdin/stdout`

---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Streams: Ejemplo de Escritura 

- Ejemplo con el m√©todo createWriteStream()


    import fs from "fs";
    const data = 'Simply Easy Learning';
    ¬†
    // Create a writable stream
    const writerStream = fs.createWriteStream('output.txt');
    ¬†
    // Write the data to stream with encoding to be utf8
    writerStream.write(data,'UTF8');
    ¬†
    // Mark the end of file
    writerStream.end();
    ¬†
    // Handle stream events --> finish, and error
    writerStream.on('finish', function() {
        console.log("Write completed.");
    });
    ¬†
    writerStream.on('error', function(err){
      console.log(err.stack);
    });
    ¬†
    console.log("Program Ended");
---
### Ejercicio 13

<hr>

- Leer de la consola un texto y guardarlo en un fichero

---

name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Pipes
 
Conexi√≥n de un stream de lectura con un stream de escritura:


    const streamLectura = fs.createReadStream('./archivo-texto.txt');
    const streamEscritura = fs.createWriteStream('./otro-archivo.txt');

Para conectar los dos streams se usa:


    streamLectura.pipe(streamEscritura);

---

### Ejercicio 14

<hr>

- Copiar de un fichero a otro (ejercicio de pipes)

---
name:streamsintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Streams: Encadenando streams

- Mecanismo para conectar la salida de un stream a m√∫ltiples streams mediante piping.

- Ejemplo generar archivo comprimido:


    import fs from 'fs';
    import zlib from 'zlib';
    ¬†
    // Compress the file input.txt to input.txt.gz
    fs.createReadStream('input.txt')
      .pipe(zlib.createGzip())
      .pipe(fs.createWriteStream('input.txt.gz'));
      
    console.log("File Compressed.");
---

### Ejercicio 14

<hr>

Descomprimir un fichero .gz creado con el ejemplo anterior. Buscar la documentaci√≥n de la api '__`zlib`__

---

name: fs
task: [<< √≠ndice de contenidos >>](#contenido)

### M√≥dulo FileSystem

En NodeJS todas las operaciones de acceso al sistema de archivos est√°n englobadas dentro del m√≥dulo "fs" (File System):

      import fs from 'fs';

Los m√©todos del m√≥dulo fs existen en las dos alternativas: s√≠ncrona y as√≠ncrona. Ej:

      import fs from 'fs';
¬†
    // Asynchronous read
    fs.readFile('input.txt', (err, data) => {
      if (err) return console.error(err);
      
      console.log("Asynchronous read: " + data.toString());
    });

    // Synchronous read
    const data = fs.readFileSync('input.txt');
    console.log("Synchronous read: " + data.toString());
    ¬†
    console.log("Program Ended");

---

name: filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Abrir un fichero


__`fs.open(path, flags[, mode], callback)`__

      // Asynchronous - Opening File
      console.log("Going to open file!");
      fs.open('input.txt', 'r+', (err, fd) => {
        if (err) {
            return console.error(err);
        }
        console.log("File opened successfully!");     
      });

---

name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Sacar informaci√≥n de un fichero

__`fs.stat(path, callback)`__


      console.log("Going to get file info!");
      fs.stat('input.txt', (err, stats) => {
        if (err) {
            return console.error(err);
        }
        console.log(stats);
        console.log("Got file info successfully!");
        
        // Check file type
        console.log("isFile ? " + stats.isFile());
        console.log("isDirectory ? " + stats.isDirectory());    
      });

---

name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Escribir en un fichero

__`fs.writeFile(filename, data[, options], callback)`__

    console.log("Going to write into existing file");
    fs.writeFile('input.txt', 'Simply Easy Learning!', err => {
      if (err) {
          return console.error(err);
      }
      
      console.log("Data written successfully!");
      console.log("Let's read newly written data");
      fs.readFile('input.txt', (err, data) => {
          if (err) {
            return console.error(err);
          }
          console.log("Asynchronous read: " + data.toString());
      });
    });

---

name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Leer de un fichero

__`fs.read(fd, buffer, offset, length, position, callback)`__

    const buf = new Buffer(1024);
    ¬†
    console.log("Going to open an existing file");
    fs.open('input.txt', 'r+', (err, fd) => {
      if (err) {
          return console.error(err);
      }
      console.log("File opened successfully!");
      console.log("Going to read the file");
      fs.read(fd, buf, 0, buf.length, 0, (err, bytes) => {
          if (err){
            console.log(err);
          }
          console.log(bytes + " bytes read");
          
          // Print only read bytes to avoid junk.
          if(bytes > 0){
            console.log(buf.slice(0, bytes).toString());
          }
      });
    });

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Cerrar un fichero

__`fs.close(fd, callback)`__

    const buf = new Buffer(1024);
    ¬†
    console.log("Going to open an existing file");
    fs.open('input.txt', 'r+', (err, fd) => {
      if (err) {
          return console.error(err);
      }
      console.log("File opened successfully!");
      console.log("Going to read the file");
      
      fs.read(fd, buf, 0, buf.length, 0, (err, bytes) => {
          if (err){
            console.log(err);
          }
          // Print only read bytes to avoid junk.
          if(bytes > 0){
            console.log(buf.slice(0, bytes).toString());
          }
          // Close the opened file.
          fs.close (fd, err => {
            if (err){
                console.log(err);
            } 
            console.log("File closed successfully.");
          });
      });
    });

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Truncar un fichero

__`fs.ftruncate(fd, len, callback)`__

    const buf = new Buffer(1024);
    ¬†
    console.log("Going to open an existing file");
    fs.open('input.txt', 'r+', (err, fd) => {
      if (err) {
          return console.error(err);
      }
      console.log("File opened successfully!");
      console.log("Going to truncate the file after 10 bytes");
      
      // Truncate the opened file.
      fs.ftruncate(fd, 10, err => {
          if (err){
            console.log(err);
          } 
          console.log("File truncated successfully.");
          console.log("Going to read the same file"); 




SIGUE>>>>>>>>>>>>>>>

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Truncar un fichero


<<<<<<<<<<<<<<<<<<<<CONTINUACION


      fs.read(fd, buf, 0, buf.length, 0, (err, bytes) => {
            if (err){
                console.log(err);
            }
    ¬†
            // Print only read bytes to avoid junk.
            if(bytes > 0){
                console.log(buf.slice(0, bytes).toString());
            }
    ¬†
            // Close the opened file.
            fs.close(fd, err => {
                if (err){
                  console.log(err);
                } 
                console.log("File closed successfully.");
            });
          });
      });
    });

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Borrar un fichero

__`fs.unlink(path, callback)`__


    
      console.log("Going to delete an existing file");

    fs.unlink('input.txt', err => {
      if (err) {
          return console.error(err);
      }
      console.log("File deleted successfully!");
    });
---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Crear un directorio

__`fs.mkdir(path[, mode], callback)`__


      console.log("Going to create directory /tmp/test");
      
      fs.mkdir('/tmp/test', err => {
        if (err) {
            return console.error(err);
        }
        console.log("Directory created successfully!");
      });

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Leer un directorio

__`fs.readdir(path, callback)`__

    console.log("Going to read directory /tmp");
    fs.readdir("/tmp/", (err, files) => {
      if (err) {
          return console.error(err);
      }
      files.forEach( file => {
          console.log( file );
      });
    });

---
name:filesystem
task: [<< √≠ndice de contenidos >>](#contenido)

### FileSystem: Eliminar un directorio

__`fs.rmdir(path, callback)`__

    
    console.log("Going to delete directory /tmp/test");

    fs.rmdir("/tmp/test", err =>{
      if (err) {
          return console.error(err);
      }
      console.log("Going to read directory /tmp");
      
      fs.readdir("/tmp/", (err, files) => {
          if (err) {
            return console.error(err);
          }
          files.forEach( file => {
            console.log( file );
          });
      });
    });

---

### Ejercicio a entregar
<hr>

Crear un m√≥dulo para empaquetar los ejercicios de node sin incluir los directorios node_modules.

---
name: tcp
class: center, middle, inverse
## [TCP y SOCKET](#Qu√© es Node.js?)
---

name:tcpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### TCP y SOCKET

[Transmission Control Protocol](https://es.wikipedia.org/wiki/Protocolo_de_control_de_transmisi%C3%B3n), es el protocolo de comunicaci√≥n m√°s importante de los Internet protocol ([IP](https://es.wikipedia.org/wiki/Protocolo_de_internet)). Proporciona un mecanismo de transporte a la capa de aplicaciones.
En TCP se basan otros protocolos como: HTTP, iRC, SMTP e IMAP.

Node implementa un __servidor HTTP__ en forma de pseudo-class en `http.Server`, que proviene de la pseudo-clase `net.Server` del servidor TCP. 

---
task: [<< √≠ndice de contenidos >>](#contenido)

### TCP: Crear un servidor

Importamos el m√≥dulo [`Net`](https://nodejs.org/api/net.html):

    import net from 'net'
    const server = net.createServer(socket => {
      console.log('new connection established);
      socket.on('data', data => {
        console.log('got data');
      });
      
      socket.on('end', function(data) {
        console.log('connection ended');
    });

      socket.write('Bienvenido. Escribe algo');
    })
    server.listen(4001);

- El m√©todo `createServer()` del package `Net` se vincula al puerto TCP 4001. 
- Al m√©todo `createServer()` se pasa una funci√≥n de _callback_ que se invoca cada vez que se prouduce un evento __'connection'__. 
- Dentro del _callback_ se maneja el objeto __Socket__, que se puede utilizar para enviar y recibir datos a y desde un cliente.

---
name:tcpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### TCP: Ciclo de vida de un servidor

- El objeto `server` es un `EventEmitter`, que emite los siguientes eventos:

  + __‚Äúlistening‚Äù__: Cuando el servidor escucha en el Puerto y direcci√≥n especificados
  + __‚Äúconnection‚Äù__: Cuando se establece una nueva conexi√≥n. El  _callback_ recibe el objeto `socket` 

  + __‚Äúclose‚Äù__: Cuando se cierra el servidor, termina el enlace al puerto. 

  + __‚Äúerror‚Äù__ ‚Äî Cuando ocurre un error a nivel de servidor.  Ej: Puerto ocupado o no hay permisos para hacer el binding al puerto
---
name:tcpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### TCP: Ciclo de vida de un servidor

    import net from 'net'
    
    const server = net.createServer();
    const port = 4001;
    
    server.on('listening', ()=> {
    console.log('Server is listening on port', port);    });

    server.on('connection', socket => {  
      console.log('Server has a new connection');
      socket.end();
      server.close();    });
      
    server.on('close', () => {
      console.log('Server is now closed');      });

    server.on('error', err => {
      console.log('Error occurred:', err.message);    });

    server.listen(port);

El __Cliente__ para conectarse al servidor: 
`telnet localhost 4001 √≥ nc localhost 4001`

Para salir del cliente: ctrl++
---
task: [<< √≠ndice de contenidos >>](#contenido)

### SOCKET

Es el primer argumento de la funci√≥n _callback_ que devuelve el __evento ‚Äúconnection‚Äù__

El objeto `socket` es un _stream duplex_ (lectura y escritura). Emite el evento __‚Äú`data`‚Äù__ cuando devuelve un paquete de datos y el evento __‚Äú`end`‚Äù__ cuando se cierra la conexi√≥n.

Tambi√©n es un stream de escritura, por lo que puede escribir buffers o strings mediante el m√©todo __`socket.write()`__. 

Otros m√©todos accesibles, por ser stream son: __`socket.pause()`__, __`socket.resume()`__, o incluso se puede hacer pipe a cualquier stream de escritura. 

Para otras caracter√≠sticas mirar la documentaci√≥n de [node.js](https://nodejs.org/api/net.html#net_class_net_socket)

---
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo de server tcp

    import net from 'net'
    
    const server = net.createServer();
    const port = 4001;

    const listener = socket =>{
      socket.setEncoding('utf8');
      socket.write("Hello! You can start typing. Type 'quit' to exit.\n");
      socket.on('data', function(data) {
      console.log('got:', data.toString())
      if (data.trim().toLowerCase() === 'quit') {
      socket.write('Bye bye!');
      return socket.end();
      }
      socket.write(data);
      });
      socket.on('end', function() {
      console.log('Client connection ended');
      }  

    server.on('connection',listener);
    server.listen(port);
---
task: [<< √≠ndice de contenidos >>](#contenido)

### CHAT SERVER

Instanciar el servidor, bindear eventos importantes (error, close) y unirlo al puerto 4001:

    import net from 'net';
    const server = net.createServer();
    server.on('error', err => {
    console.log('Server error:', err.message);
    });
    server.on('close', () => console.log('Server closed'));
    
    server.listen(4001);

Aceptar peticiones de clientes (evento connection):

    server.on('connection', socket => {
    console.log('got a new connection');
    });

---

task: [<< √≠ndice de contenidos >>](#contenido)

### CHAT SERVER

Leer datos de la conexi√≥n

    server.on('connection', socket => {
    console.log('got a new connection');
    socket.on('data', function(data) {
    console.log('got data:', data);
    });
    });

Recopilar todos los clientes para transmitirles los datos de un cliente. Para ello hay que almacenar todas las conexiones en un repositorio

      let sockets = [];
      server.on('connection', socket => {
      console.log('got a new connection');
      sockets.push(socket);

---

task: [<< √≠ndice de contenidos >>](#contenido)

### CHAT SERVER

Transmitir los datos a todos los clientes

    socket.on('data', data => {
    console.log('got data:', data);
    sockets.forEach(otherSocket => {
    if (otherSocket !== socket) {
    otherSocket.write(data);
    }
    });
    });

---
Ejercicio 14
<hr>

Sobre el servidor de chat realizar las siguientes funciones:

- Registrar la eliminaci√≥n de una conexi√≥n cerrada
- Pedir un nombre a cada cliente y registrarlo asociado a la conexi√≥n. Si el nombre ya existe pedir otro nuevo.
- Cuando se conecte un cliente nuevo comunicarlo al resto de clientes, as√≠ como el n√∫mero de clientes registrados.
- Imprimir el prompt de otro cliente, delante del texto.
---
name: http
class: center, middle, inverse
## [HTTP](#Qu√© es Node.js?)
---

name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### HTTP

Hypertext Transfer Protocol, o [__HTTP__](https://es.wikipedia.org/wiki/Protocolo_de_transferencia_de_hipertexto), es un protocol a nivel de aplicaci√≥n que permite la transmisi√≥n de contenido. Es el fundamento de la World Wide Web.

HTTP es un protocolo basado en texto que trabaja sobre la capa de TCP. 

La versi√≥n encriptada de HTTP se denomina HTTP Secure, o [__HTTPS__](https://es.wikipedia.org/wiki/Protocolo_seguro_de_transferencia_de_hipertexto)

HTTP es un protocolo de petici√≥n-respuesta desarrollado sobre las bases de la programaci√≥n cliente-servidor. Normalmente, un navegador se utiliza como cliente en una transacci√≥n HTTP

Cuando se introduce una URL en un navegador, se realiza una __petici√≥n HTTP__ al servidor que hospeda la URL, suele hacerse a trav√©s del puerto 80 (o 443 si es HTTPS). El servidor procesa la petici√≥n y responde al cliente
---

name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Servidor HTTP en Node.JS

    import http from 'http';

    const server = http.createServer();

    server.on('request', function(req, res) {
      res.writeHead(200, {'Content-Type': 'text/html'});
      res.write('Hello World!');
      res.end();
    });

    server.listen(4000);

- Cuando un cliente hace una petici√≥n, el servidor HTTP emite un evento de __request__ pasando un objeto __request HTTP__ y uno __response HTTP__.  El objeto `request` HTTP permite consultar propiedades de la petici√≥n, mientras que el objeto `response` HTTP permite construir la respuesta que se enviar√° al cliente

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### HTTP: El objeto HTTPServerRequest 

Contiene las siguientes propiedades:

- `req.url`: Contiene el string de la URL demandada desde el cliente
- `req.method`: Contiene el m√©todo HTTP usado en la petici√≥n: GET, POST, DELETE o HEAD
- `req.headers`: Contiene las propiedades de la cabecera de la petici√≥n
- `res.end(util.inspect(req.headers))`;

Cuando se realiza una petici√≥n a un servidor el __`body`__ de la petici√≥n no se recibe inmediatamente. Pero se puede "escuchar" un evento __data__ que maneje la informaci√≥n cuando llegue. El objeto request es un stream de lectura

    const writeStream = ...
    require('http').createServer(function(req, res) {
    req.on('data', function(data) {
    writeStream.write(data);
    });
    }).listen(4001);

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### HTTP: El objeto HTTPServerResponse 

En la respuesta se puede escribir: __Head__ y __Body__.
Para escribir la cabecera usar: `res.writeHead(status, headers)`

    require('http').createServer(function(req, res) {
    res.writeHead(200, {
    'Content-Type': 'text/plain',
    'Cache-Control': 'max-age=3600' });
    res.end('Hello World!');
    }).listen(4000);

Las cabeceras se pueden modificar mientras no se haya enviado el body de la respuesta (`res.write` o `res.end`):

`res.setHeader(status, headers)`

`res.removeHeader('Cache-Control');`

El body se escribe directamente: `res.write('Hello');` o
utilizando un buffer:

    let buffer = new Buffer('Hello World');
    res.write(buffer);
---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Respuesta troceada STREAMING HTTP

__HTTP chunked encoding__ permite al servidor mantener el envio de datos al cliente sin tener que enviar el tama√±o del cuerpo de la respuesta (body size). Si no se ha especificado la propiedad Content-Length del header, por defecto, El servidor Node HTTP env√≠a el siguiente header al cliente:

.center[`Transfer-Encoding: chunked`]

Esta cabecera permite al cliente recibir los datos de forma troceada, enviando un ultimo trozo de longitud 0 antes de que el cliente termine de procesar la respuesta. Esto tiene utilidad para el envio de __streaming de texto, audio, o v√≠deo__

Algunos ejemplos de streaming usando estas caracter√≠sticas son el piping de un fichero al stream

---
### Ejercicio 15
<hr>
Crear un servidor http
Crear un stream sobre un v√≠deo '.mp4'
Fijar la propiedad Content-Type de la cabecera de la respuesta
Hacer un pipe a la respuesta HTTP
Abrir el navegador y comprobar que el v√≠deo empieza a visualizarse sin haberse cargado completamente.

---
### Ejercicio 16
<hr>

Crear un servidor HTTP que devuelva texto plano con 100 l√≠neas separadas de timestamp cada segundo, durante 10 segundos.

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### CLIENTE HTTP

HTTP ocupa el centro de muchas infraestructuras no s√≥lo como servidor de contenido est√°tico sino tambi√©n como servidor de informaci√≥n a trav√©s de llamadas a una API p√∫blica

Una de las fortalezas de Node es el manejo de las E/S, esto lo convierten en una buena herramienta para proveer informaci√≥n y manejar los servicios HTTP.

El protocolo HTTP presenta dos propiedades: la URL y el m√©todo.

El m√©todo GET es el m√©todo principal m√°s usado, otros m√©todos como POST (principal m√©todo para enviar formularios web), PUT, DELETE, and HEAD.

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### M√©todos o Verbos en una petici√≥n



Request method| Use| Response|
---|---|---|
POST| Create new data in the database| New data object as seen in the database
GET| Read data from the database| Data object answering the request
PUT| Update a document in the database| Updated data object as seen in the database
DELETE| Delete an object from the database| Null

El m√©todo es importante, porque una API REST bien dise√±ada deber√≠a utilizar la misma URL para diferentes acciones. En estos casos el m√©todo le dice al servidor el tipo de operaci√≥n a realizar.
---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### C√≥digos de respuesta (STATUS_CODE)

Una API REST bien construida debe devolver el c√≥digo de respuesta correcto
<table style="font-size:14px">
<thead>
<tr>
<th>Status code</th>
<th>Name</th>
<th>Use case</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>OK</td>
<td>A successful GET or PUT request</td>
</tr>
<tr>
<td>201</td>
<td>Created</td>
<td>A successful POST request</td>
</tr>
<tr>
<td>204</td>
<td>No content</td>
<td>A successful DELETE request</td>
</tr>
<tr>
<td>400</td>
<td>Bad request</td>
<td>An unsuccessful GET, POST, or PUT request due to invalid content</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
<td>Requesting a restricted URL with incorrect credentials</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>Making a request that isn‚Äôt allowed</td>
</tr>
<tr>
<td>404</td>
<td>Not found</td>
<td>Unsuccessful request due to an incorrect parameter in the URL</td>
</tr>
<tr>
<td>405</td>
<td>Method not allowed</td>
<td>Request method not allowed for the given URL</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
<td>Unsuccessful POST request when another object with the same data already exists</td>
</tr>
<tr>
<td>500</td>
<td>Internal server error</td>
<td>Problem with your server or the database server</td>
</tr>
</tbody>
</table>
---

name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Crear peticiones HTTP

Adem√°s de crear servidores, el modulo http permite crear peticiones mediante el m√©todo __`request()`__
El m√©todo request() toma dos argumentos: `options` y `callback`. 

- __`options`__ se usa para parametrizar la petici√≥n HTTP

- __`callback`__ funci√≥n que es invocada cuando se recibe una respuesta a la petici√≥n

- __`IncomingMessage`__ es el √∫nico argumento que se le pasa al callback

`request()` Tambien devuelve una instancia de `http.ClientRequest`, que es un stream de escritura.

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo de Petici√≥n GET HTTP (Cliente HTTP)

    import http from "http";
    
    const request = http.request({
      hostname: "localhost",
      port: 8000,
      path: "/",
      method: "GET",
      headers: {"Host": "localhost:8000"	}
    }, 
    response => {
      let statusCode = response.statusCode;
      let headers = response.headers;
      let statusLine = "HTTP/" + response.httpVersion + " " + statusCode + " " + http.STATUS_CODES[statusCode];
    
      console.log(statusLine);
      for (header in headers) {
              console.log(header + ": " + headers[header]); 
      }
      console.log();
      response.setEncoding("utf8");
      response.on("data", data => {
              process.stdout.write(data); 
        });
      response.on("end", function() {
              console.log();
      });});

    request.end();
---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo de Petici√≥n HTTP

Versi√≥n reducida, no se puede fijar la cabecera:

    import...
    const request = http.request("http://localhost:8000/", response => {
      response.setEncoding("utf8");
      response.on("data", function(data) {
        process.stdout.write(data);
      });
      response.on("end", function() {
        console.log();
      });
    });
  
     request.end();
---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo de Petici√≥n POST HTTP (Cliente HTTP)

    import http from "http";
    import qs from "querystring";
    
    const body = qs.stringify({
          foo: "bar",
          baz: [1, 2]
      });
    
    const request = http.request({
      hostname: "localhost",
      port: 8000,
      path: "/",
      method: "POST",
      headers: {
        "Host": "localhost:8000",
        "Content-Type": "application/x-www-form-urlencoded",
        "Content-Length": Buffer.byteLength(body)
        }
      }, 
      response => {
        response.setEncoding("utf8");
        response.on("data", data => {
        process.stdout.write(data);
        });
    
      response.on("end", () => console.log(););
      });
      request.end(body);

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Ejemplo de Servidor que procesa POST HTTP (Cliente HTTP)

    import http from "http";
    import qs from "querystring";
    
    
    const server = http.createServer((request, response) => {
    
      let bodyString = "";
      request.setEncoding("utf8");

      request.on("data", data => {

        bodyString += data;
        });

      request.on("end", () => {

        let body = qs.parse(bodyString);
      
        for (let b in body) {

          response.write(b + ' = ' + body[b] + "\n");
        }
          response.end();
        });
    });
    
    server.listen(8000);

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Middlewares

Bloque de c√≥digo que se ejecuta entre la petici√≥n que hace el usuario (__request__) hasta que la petici√≥n llega al servidor.

Una parte del middleware recibe una petici√≥n entrante y la puede procesar completamente o pasarla a otra parte del middleware para un procesamiento adicional antes de enviar la respuesta al cliente.

Las funciones de middleware, por tanto, tienen __acceso al objeto de solicitud (req)__, __al objeto de respuesta (res)__ y a la __siguiente funci√≥n de middleware__ en el ciclo de solicitud/respuestas de la aplicaci√≥n. La siguiente funci√≥n de middleware se denota normalmente con una variable denominada __next__.
Ej:

    function middleware(request, response, next) {
    return next();
    }

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Middlewares

Las funciones de middleware pueden realizar las siguientes tareas:

- Ejecutar cualquier c√≥digo.

- Realizar cambios en la solicitud y los objetos de respuesta.

- Finalizar el ciclo de solicitud/respuestas.

- Invocar el siguiente middleware en la pila.

Si la funci√≥n de middleware actual no finaliza el ciclo de solicitud/respuestas, debe invocar `next()` para pasar el control a la siguiente funci√≥n de middleware. De lo contrario, la solicitud quedar√° colgada.

---
name:httpintro
task: [<< √≠ndice de contenidos >>](#contenido)

### EJEMPLO SERVIDOR CON MIDDLEWARE

    import http from 'http';
    // Instalamos e importamos el m√≥dulo connect
    import connect from 'connect'; 

    const app = connect();
    let isLogin = false;

    app.use((req,res,next) => { 
      if(req.url.indexOf("favicon.ico")>0){
        return; 
        } 
        next()
      })
    app.use((req,res,next)=>{//Funci√≥n middleware que eval√∫a si estamos conectados
      if(isLogin) return next();
      else{ 
        console.log('No est√°s logado');
        res.end('No estas logado')}
      })
    app.use((request,response,next)=>{//Funci√≥n middleware que genere la respuesta

      response.setHeader('Content-Type','text/html' );
      response.end('Hello <strong>HTTP</strong>!');
      })

    app.listen(4000);

    http.createServer(app);

---
### Ejercicio 17
<hr>

- Rehacer el servidor de la petici√≥n post con la capa de middleware:

    - Utilizar el package:


    import¬†bodyParser¬†from 'body-parser';
    app.use(bodyParser.urlencoded({extended:¬†false}));

---

name: express
class: center, middle, inverse
## [EXPRESS](#Qu√© es Node.js?)

---
name:expressintro
task: [<< √≠ndice de contenidos >>](#contenido)

### MIDDLEWARES CON EXPRESS

<br>
<br>
.center[<img src="https://imgur.com/tbzy5Mo.png" width=98% height=98%>]

---
name:expressintro
task: [<< √≠ndice de contenidos >>](#contenido)

### MIDDLEWARES CON EXPRESS

- Creamos un proyecto con archivo `app.js` y generamos `package.json`

- Instalamos express: 

.inverse[<pre class = codigo> npm install express --save</pre>
]

- De la p√°gina oficial bajamos el ejemplo ["hola mundo"](https ://expressjs.com/es/starter/hello world. html):


      import express from 'express'
      const app = express();

      app.get('/', (req, res) => res.send('Hello World!'));

      app.listen(3000, ()=> 
        console.log('Example app listening on port 3000!'));



---
### Ejercicio 18
<hr>

- Insertamos el resto de operaciones http:  `post`, `put`, `delete`

- Probamos con Postman

- Incorporamos dos m√©todos de middleware que eval√∫en: 

    - Si estamos logados

    - Se guarde una traza de la url desde donde se conecta el cliente y el m√©todo http

---
### Ejercicio 19
<hr>

Incorporar la fecha actual a la respuesta a la petici√≥n mediante un middleware.

---
name:expressintro
task: [<< √≠ndice de contenidos >>](#contenido)

### Middlewares de terceros
<br>
<table style="font-size: 14px">
<thead>
<tr>
<th>Middleware</th>
<th>Descripci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td>body-parser</td>
<td>Parsea el cuerpo de la petici√≥n entrante: req.body property.</td>
<td></td>
</tr>
<tr>
<td>compression</td>
<td>Comprime el cuerpo de la respuesta HTTP</td>
<td></td>
</tr>
<tr>
<td>cookie-parser</td>
<td>Parsea la cabecera "Cookie" y genera la propiedad req.cookies. Permite manejar cookies firmadas</td>
<td></td>
</tr>
<tr>
<td>cookie-session</td>
<td>Almacena todos los datos de sesi√≥n de cliente en una cookie</td>
<td></td>
</tr>
<tr>
<td>express-debug</td>
<td>A√±ade a la aplicaci√≥n un separador con informaci√≥n sobre las variables de plantilla(locals), la sesi√≥n actual, datos de solicitud √∫tiles, etc.</td>
<td></td>
</tr>
<tr>
<td>express-session</td>
<td>Almacena el id de session en la cookie y el resto de informaci√≥n en el servidor</td>
<td></td>
</tr>
<tr>
<td>express-simple-cdn</td>
<td>Utiliza una CDN (Red de entrega de contenido) para los activos est√°ticos, con soporte de varios hosts (por ejemplo, cdn1.host.com, cdn2.host.com)</td>
<td></td>
</tr>
<tr>
<td>helmet</td>
<td>Protege las aplicaciones estableciendo varias cabeceras HTTP.</td>
<td></td>
</tr>
<tr>
<td>method-override</td>
<td>Anula las cabeceras que no permiten ciertos m√©todos HTTP (PUT, DELETE)</td>
<td></td>
</tr>
<tr>
<td>morgan: anteriormente logger</td>
<td>Genera un log de la aplicaci√≥n</td>
<td></td>
</tr>
<tr>
<td>Passport</td>
<td>Autentica la aplicaci√≥n mediante diferentes estrategias</td>
<td></td>
</tr>
<tr>
<td>serve-static:</td>
<td>Sirve contenido est√°tico</td>
<td></td>
</tr>
</tbody>
</table>

---

name: apirest
class: center, middle, inverse
## [API RESTful](#Qu√© es Node.js?)
---
name:apirest
task: [<< √≠ndice de contenidos >>](/courses/meanstack/module-3/lessons/express/express.html#contenido)

### API RESTful

REST no es un protocolo, sino un __conjunto de reglas y principios__ que permiten desarrollar servicios web utilizando __HTTP como protocolo__ de comunicaciones entre el cliente y el servicio web. 

Se basa en definir acciones sobre recursos mediante el uso de los m√©todos __GET__, __POST__, __PUT__ y __DELETE__ inherentes a HTTP. 

Una API REST es un interfaz sin estado (_stateless_) de una aplicaci√≥n. En el caso de MEAN stack, la API REST se usa para crear un interfaz sin estado de acceso a la base de datos

---
name:apirest2
task: [<< √≠ndice de contenidos >>](/courses/meanstack/module-3/lessons/express/express.html#contenido)

### API RESTful

REST se basa en el uso de est√°ndares abiertos:
- __URI__ para la localizaci√≥n de recursos, 

- __HTTP__ como protocolo de transporte,

- Los __verbos HTTP__ para especificar las acciones sobre los recursos y

- Los __tipos MIME__ (Multipurpose Internet Mail Extensions) para la representaci√≥n de los recursos (XML, JSON, XHTML, HTML, PDF, GIF, JPG, PNG, etc.). 


---
name:apirest3
task: [<< √≠ndice de contenidos >>](/courses/meanstack/module-3/lessons/express/express.html#contenido)

### API RESTful: URLs

Las URLS de las peticiones a una API REST siguen un formato est√°ndar. Este formato permite seleccionar, utilizar y mantener de forma f√°cil nuestra API.

La mejor manera de representar las URLs de la API es pensando en las colecciones de la base de datos. Normalmente, se dispondr√° de un conjunto de URLs por cada colecci√≥n. Se pueden tener, adem√°s, un conjunto de URLs para cada conjunto de subdocumentos. Cada URL deber√° tener, dentro del conjunto, la misma ruta b√°sica (_path_), y par√°metros adicionales.

Por cada conjunto de URLs, se requieren cubrir distintas acciones, basadas en las operaciones CRUD:

1. Alguien o algo realiza una petici√≥n a la API.
2. La API procesa la petici√≥n, requiriendo a la base de datos si fuese necesario.
3. The API __siempre__ env√≠a una respuesta al peticionario.

---
name:apirest4
task: [<< √≠ndice de contenidos >>](/courses/meanstack/module-3/lessons/express/express.html#contenido)

### API RESTful:  VERBOS (M√©todos)

A REST API recibe una petici√≥n HTTP, realiza alg√∫n procesamiento y devuelve una respuesta HTTP:

-  Crea un nuevo √≠tem
-  Lee una lista de varios √≠tems 
-  Lee un √≠tem espec√≠fico
-  Actualiza un √≠tem espec√≠fico
-  Elimina un √≠tem espec√≠fico

Loas cuatro verbos m√°s comunes son: POST, GET, PUT, and DELETE. 
Una API REST bien dise√±ada tendr√° la misma URL para distintas acciones. En estos casos, el m√©todo indica al servidor la operaci√≥n que tiene que realizar

Un plan para una API, quedar√≠a:

<table style="font-size:12px">
<thead>
<tr>
<th>Acci√≥n</th>
<th>M√©todo URL</th>
<th>ruta</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create new location</td>
<td>POST</td>
<td>/locations</td>
<td><a href="http://loc8r.com/api/locations">http://loc8r.com/api/locations</a></td>
</tr>
<tr>
<td>Read list of locations</td>
<td>GET</td>
<td>/locations</td>
<td><a href="http://loc8r.com/api/locations">http://loc8r.com/api/locations</a></td>
</tr>
<tr>
<td>Read a specific location</td>
<td>GET</td>
<td>/locations/:locationid</td>
<td><a href="http://loc8r.com/api/locations/123">http://loc8r.com/api/locations/123</a></td>
</tr>
<tr>
<td>Update a specific location</td>
<td>PUT</td>
<td>/locations/:locationid</td>
<td><a href="http://loc8r.com/api/locations/123">http://loc8r.com/api/locations/123</a></td>
</tr>
<tr>
<td>Delete a specific location</td>
<td>DELETE</td>
<td>/locations/:locationid</td>
<td><a href="http://loc8r.com/api/locations/123">http://loc8r.com/api/locations/123</a></td>
</tr>
</tbody>
</table>
---

name:apirest5
task: [<< √≠ndice de contenidos >>](/courses/meanstack/module-3/lessons/express/express.html#contenido)

### API RESTful: Formato de la respuesta

La API deber√≠a devolver un formato consistente de datos. Los formatos t√≠picos de una API REST son 
XML y/o JSON. En el caso de MEAN stack utilizaremos JSON, que encaja de forma natural con el ecosistema JavaScript. JSON es tambi√©n m√°s compacto que XML lo que ayuda a acelerar l ios tiempos de respuesta y la eficiencia al disminuir el ancho de banda requerido.

La API devolver√° una de las siguientes respuestas por cada petici√≥n:

- Un objeto JSON con los datos de respuesta a la consulta
- Un objeto JSON con datos de error
- Una respuesta nula

El tipo de respuesta deber√≠a especificarse con el par√°metro `content-type` dentro del __header__:

```javascript
{Content-type: application/json}
```
---



